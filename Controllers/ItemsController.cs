using Microsoft.AspNetCore.Mvc;
using InventoryService.Data;
using InventoryService.Models;
using InventoryService.Services;
using System.Linq;
namespace InventoryService.Controllers { [ApiController] [Route("[controller]")] public class ItemsController : ControllerBase { private readonly InventoryContext _ctx; private readonly ItemValidator _val = new ItemValidator(); public ItemsController(InventoryContext ctx) { _ctx = ctx; } [HttpGet] public IActionResult Get([FromQuery] string q) { if(string.IsNullOrEmpty(q)) return Ok(_ctx.Items.ToList()); return Ok(_ctx.Items.Where(i => i.Name.Contains(q)).ToList()); } [HttpGet("{id}")] public IActionResult Get(int id) { var i = _ctx.Items.Find(id); if(i==null) return NotFound(); return Ok(i); } [HttpPost] public IActionResult Create(Item i) { if(!_val.IsValid(i)) return BadRequest(); _ctx.Items.Add(i); _ctx.SaveChanges(); return CreatedAtAction(nameof(Get), new { id = i.Id }, i); } [HttpPut("{id}")] public IActionResult Update(int id, Item i) { if(id!=i.Id || !_val.IsValid(i)) return BadRequest(); _ctx.Entry(i).State = Microsoft.EntityFrameworkCore.EntityState.Modified; _ctx.SaveChanges(); return NoContent(); } [HttpDelete("{id}")] public IActionResult Delete(int id) { var i = _ctx.Items.Find(id); if(i==null) return NotFound(); _ctx.Items.Remove(i); _ctx.SaveChanges(); return NoContent(); } } }